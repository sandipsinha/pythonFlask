<!DOCTYPE html>
<html>
<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel='stylesheet' type='text/css' href="{{ url_for('touchbiz.static', filename='stylesheets/touchbiz.css') }}"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">

</head>
<body>
<div class='container' >
<div id='slide1' class='row-fluid'>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Owner:</label>
    <div data-key="owner" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Status:</label>
    <div data-key="status" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right disabled">Tier:</label>
    <div data-key="tier" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Volume:</label>
    <div data-key="volume" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Retention:</label>
    <div data-key="retention" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
    <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Plan Type:</label>
    <div data-key="plan_type" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
    <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Payment Method:</label>
    <div data-key="payment_method" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Billing Frequency:</label>
    <div data-key="period" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <label class="col-xs-2 text-right">Sub Rate:</label>
    <div data-key="rate" class="col-xs-2 text-left"></div>
    <div class="col-xs-5"></div>
  </div>
  <div class='row'></div>
  <div class='row'>
    <div class="col-xs-3"></div>
    <div class='col-xs-4 text-left'>
        <button id="touchbiz-manipulator" class="btn btn-info btn-block text-center">Touch This Account</button>
    </div>
    <div class="col-xs-5"></div>
  </div>
</div>
</div>

<div class='container' >
<div id='slide2' class='row-fluid'>
    <form class="form-horizontal touchbiz-form">
    <fieldset>
    <!-- Text input-->
    <div class="touchbiz-form form-group">
    <label class="col-xs-4 control-label text-right" for="tier">Tier</label>  
    <div class="col-xs-4">
    <input id="tier" name="tier" data-key='tier' type="text" placeholder="tier" class="form-control input-sm">
        
    </div>
    </div>

    <!-- Appended Input-->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="volume">Volume</label>
    <div class="col-xs-4">
        <div class="input-group">
        <input id="volume" name="volume" data-key='volume' class="form-control input-sm" placeholder="volume" type="text">
        <span class="input-group-addon">GB</span>
        </div>
        
    </div>
    </div>
    <!-- Appended Input-->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="retention">Retention</label>
    <div class="col-xs-4">
        <div class="input-group">
        <input id="retention" name="retention" data-key='retention' class="form-control input-sm" placeholder="retention" type="text">
        <span class="input-group-addon">Days</span>
        </div>
        
    </div>
    </div>
        <!-- Select Basic -->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="plan_type">Plan Type</label>
    <div class="col-xs-4">
        <select id="plan_type" name="plan_type" data-key='plan_type' class="form-control input-sm">
        <option value="standard">Standard</option>
        <option value="tru-up">Tru-up</option>
        <option value="flex">Flex</option>
        </select>
    </div>
    </div>
         <!-- Select Basic -->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="payment_method">Payment Method</label>
    <div class="col-xs-4">
        <select id="payment_method" name="payment_method" data-key='payment_method' class="form-control input-sm">
        <option value="Credit Card">Credit Card</option>
        <option value="Invoice">Invoice</option>
        <option value="Wire Transfer">Wire Transfer</option>
        </select>
    </div>
    </div>
    <!-- Select Basic -->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="billing_period">Billing Frequency</label>
    <div class="col-xs-4">
        <select id="billing_period" name="billing_period" data-key='period' class="form-control input-sm">
        <option value="monthly">Monthly</option>
        <option value="annual-upfront">Annual Upfront</option>
        <option value="annual-monthly">Annual Monthly</option>
        <option value="annual-quarterly">Annual Quarterly</option>
        </select>
    </div>
    </div>

    <!-- Appended Input-->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="sub_rate">Sub Rate</label>
    <div class="col-xs-4">
        <div class="input-group">
        <input id="sub_rate" name="sub_rate" data-key='rate' class="form-control input-sm" placeholder="$$$" type="text">
        <span class="input-group-addon">.00</span>
        </div>
        
    </div>
    </div>

    <!-- Button (Double) -->
    <div class="form-group">
    <label class="col-xs-4 control-label text-right" for="save"></label>
    <div class="col-xs-8">
        <button id="save" name="save" class="btn btn-info btn-xs">Save</button>
        <button id="cancel" name="cancel" class="btn btn-inverse btn-xs">Cancel</button>
        <img class='spinner' src="{{ url_for('touchbiz.static', filename='images/spinner.svg') }}"/>
    </div>
    </div>

    </fieldset>
        
    </form>
</div>
</div>
</body>
<script type='text/javascript'>
$(document).ready( function() {
(function ($, document) {


    var form = $('.touchbiz-form') ;
    var failure = $('<div class="span4 offset4 text-center"><span>Failed!</span></div>' )
    var success = $('<div class="span4 offset4 text-center"><span>Success!</span></div>' )
    var spinner = $('button#save').siblings( '.spinner' ) ;
    spinner.hide()

    $('button#save').click( function(e) {
        e.preventDefault() ;
        var button = $(this);

        button.prop('disabled', true);
        spinner.show() ;
        $.post( "{{new_url}}", form.serialize(), function( result ) {
            $('button#touchbiz-manipulator').html( 'Edit Touchbiz' );
            setData( '#slide1', result.data.new ) ;
            toggleSlides();
        })
        .fail( function() {
            $('form.touchbiz-form').before( failure );
        })
        .always( function() {
            spinner.hide() ;
            button.prop('disabled', false);
        });

    });
    
    $('button#cancel').click( function(e) {
        e.preventDefault() ;
        // revert form to initial look
        toggleSlides() ;
    });

    $('button#touchbiz-manipulator' ).click( function(e) {
        toggleSlides() ;
    }) ;

    function toggleSlides() {
        var slide1 = $('#slide1')


        if( slide1.is(':visible') ) {
            $('#slide1').hide( 0 ) ;
            $('#slide2').show( 0 ) ;
        } else {
            $('#slide2').hide( 0 ) ;
            $('#slide1').show( 0 ) ;
        }
    }

    function setData( parentid, data ) {
        for( key in data ) {
            $( parentid + ' [data-key="' + key + '"]' ).html( data[key] ) ;
        }
    }

    // Do the initial data setting
    $('#slide2').hide(0);
    setData( '#slide1', {{data|tojson|safe }} ) ;

})(jQuery, document); 
});
</script>
</html>
